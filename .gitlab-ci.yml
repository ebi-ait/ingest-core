image: openjdk:11

workflow:
  rules:
    - if: $CI_EXTERNAL_PULL_REQUEST_TARGET_BRANCH_NAME == 'dev'

stages:
  - build
  - unit-test
  - integration

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches


build:
  stage: build
  script:
    - ./gradlew
    
unit-test:
  stage: unit-test
  script:
    - ./gradlew verify
  artifacts:
    reports:
      junit:
        - build/test-results/**/TEST-*.xml

integration:
  stage: integration
  trigger: 
    project: hca/ingest-integration-tests
    branch: dev
    strategy: depend

